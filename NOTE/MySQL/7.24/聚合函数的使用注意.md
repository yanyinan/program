## 聚合函数的使用注意1

### 代码

```sql
SELECT goods_name, count - sum(num)    
FROM cart, goods     
WHERE goods.good_no = cart.goods_no    
GROUP BY goods_name, count;
```

### 疑问点

为什么给`num`使用`sum`函数而不是给`count-num`使用`sum`函数

### 答疑

这是因为在`SELECT`语句中，聚合函数(如`SUM`、`AVG`等)必须作用于GROUP BY子句中的列或常量。而在这个查询中，我们想要计算每个商品的数量差`(count-sum(num))`,所以需要先对数量进行求和`(sum(num))`,然后再用每个商品的数量减去该商品的总数量得到数量差。

如果将`sum`函数作用于`count-num`上，那么它实际上会将每个商品的数量差与所有商品的总数量相加，而不是计算每个商品的数量差。因此，我们需要先对数量进行求和，然后再用每个商品的数量减去该商品的总数量得到数量差。

## 聚合函数的使用注意2

> 聚合函数和group by使用时的注意事项

在使用聚合函数和GROUP BY子句时，需要注意以下几点：

1. SELECT语句中只能包含被分组的列和与分组列有关的列。如果选择的列不包含在GROUP BY子句中，将会产生错误。
2. 分组后的结果集将会按照分组列的值进行排序，且相同值的行会被合并为一行。
3. 当聚集函数和非聚集函数出现在一起时，需要将非聚集函数进行GROUP BY。
4. 当只做聚集函数查询时候，就不需要进行分组了。

